---
title: "Decision Tree Greentrike"
author: "Brian Krumholz"
date: "3/5/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir ="C:/Users/Lugal/OneDrive/Documents/MSBA/Project/GreentrikeMSBA/Models")

```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
library(rpart)
library(readxl)
library(tidyverse)
library(rattle)
library(party)
library(caret)
library(randomForest)
```

```{r pull_data}
df<-read.csv("C:/Users/Lugal/OneDrive/Documents/MSBA/Project/GreentrikeMSBA/Scoring Files/BG Score Extract 20210305.csv")
colnames(df)[c(1,2)]<-c("BG_Geo_Id","Score")
colnames(df)
df.score<-df[!is.na(df$`Score`),]
df.score<-df.score[,c(2,7,9,20:23)]
df.score$Score<-as.factor(df.score$Score)
```

```{r split_training}
set.seed(4)  
train.index <- sample(c(1:dim(df.score)[1]), dim(df.score)[1]*0.7)
train.df <- df.score[train.index, ]
valid.df <- df.score[-train.index, ]
```

```{r}
default.rt <- rpart(Score ~ ., method="class", data = train.df, maxdepth=4,minsplit=1)
# plot tree
# prp(default.rt, type = 1, extra = 0, under = TRUE, split.font = 12, varlen = -10)
fancyRpartPlot(default.rt,cex=.5,type=2,sub="",under=TRUE)
```


```{r score_training}
default.ct.pred<-predict(default.rt, newdata=train.df, type="class")
# cbind(default.rp.pred,train.df$Score)
cm<-confusionMatrix(as.factor(default.ct.pred),as.factor(train.df$Score))
cm
```

```{r score_validation}
default.ct.valid.pred<-predict(default.rt, newdata=valid.df, type="class")
# cbind(default.rp.pred,train.df$Score)
cm<-confusionMatrix(as.factor(default.ct.valid.pred),as.factor(valid.df$Score))
cm
```
```{r}
all.predict<-predict(default.rt,newdata=df,type="class")
census.df.out<-head(cbind(df$BG_Geo_Id,all.predict))
write.csv(census.df.out,"C:/Users/Lugal/OneDrive/Documents/MSBA/Project/GreentrikeMSBA/Scoring Files/decision_tree_census_predicted_20210307.csv")
table(all.predict)
```

```{r}
myrf <- randomForest(Score ~ .,train.df)
myrf.pred <- predict(myrf, train.df)
cm<-confusionMatrix(as.factor(myrf.pred),as.factor(train.df$Score))
cm
```

```{r}
myrf.pred <- predict(myrf, valid.df)
cm2<-confusionMatrix(as.factor(myrf.pred),as.factor(valid.df$Score))
cm2
```

```{r}
myrf.pred <- predict(myrf, valid.df)
cm2<-confusionMatrix(as.factor(myrf.pred),as.factor(valid.df$Score))
cm2
```
